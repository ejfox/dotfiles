# ============================================================================
# CORE SETTINGS
# ============================================================================

setw -g mode-keys vi
set -g escape-time 0              # Faster escape for nvim responsiveness
set -g default-terminal "xterm-256color"
set -g history-limit 10000
set -g mouse on
set -g base-index 1
setw -g pane-base-index 1
set -g allow-passthrough on

# ============================================================================
# PREFIX CONFIGURATION
# ============================================================================

unbind C-b
set -g prefix2 C-a
bind C-a send-prefix

# ============================================================================
# STATUS BAR - NO COLORS, match sketchybar spacing
# ============================================================================

set -g status on
set -g status-position top
set -g status-style "none"
set -g status-bg default
set -g status-fg default
set -g status-justify centre

# Session display - shows prefix indicator with padding
set -g status-left-length 50
set -g status-left "  #{?client_prefix,◼, }  "  # Only show when active

# Window status - minimal with nerdfont, extra spacing
setw -g window-status-format "  #I #W#{?#{==:#{window_panes},1},,#{?#{==:#{window_panes},2},⚌,#{?#{==:#{window_panes},3},☰,#{?#{==:#{window_panes},4},⚍,#{?#{==:#{window_panes},5},⚏,☷}}}}}  "
setw -g window-status-current-format "  #W  "
setw -g window-status-separator ""
setw -g window-status-style "default"
setw -g window-status-current-style "reverse"

# Right status - minimal but useful indicators with padding
set -g status-right-length 0
set -g status-right ""

# Remove all colors
set -g message-style "none"
set -g message-command-style "none"
set -g window-status-activity-style "none"
set -g window-status-bell-style "none"

# ============================================================================
# PANE STYLING
# ============================================================================

# Arrow indicators pointing to active pane - classy and minimal
set -g pane-border-indicators arrows
set -g pane-border-style "fg=default,dim"
set -g pane-active-border-style "fg=default"

# Subtle underline for active pane only
# set -g pane-border-status bottom
# set -g pane-border-format ""
# set -g pane-active-border-format "─"

# ============================================================================
# PANE NAVIGATION & MANAGEMENT
# ============================================================================

# Vim-style pane navigation
bind -r h select-pane -L
bind -r j select-pane -D
bind -r k select-pane -U
bind -r l select-pane -R

# Pane swapping
bind > swap-pane -D
bind < swap-pane -U

# Resize with capital letters
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Alt + number to switch panes directly
bind -n M-1 select-pane -t 1
bind -n M-2 select-pane -t 2
bind -n M-3 select-pane -t 3
bind -n M-4 select-pane -t 4
bind -n M-5 select-pane -t 5
bind -n M-6 select-pane -t 6
bind -n M-7 select-pane -t 7
bind -n M-8 select-pane -t 8
bind -n M-9 select-pane -t 9

# Window splitting with current path
bind - split-window -v -c "#{pane_current_path}"
bind _ split-window -h -c "#{pane_current_path}"

# ============================================================================
# WINDOW NAVIGATION & MANAGEMENT
# ============================================================================

# Create new windows with current path
bind c new-window -c "#{pane_current_path}"

# Alt+h/l for prev/next window
bind -n M-h previous-window
bind -n M-l next-window

# Shift+arrows for window navigation
bind -n S-Left previous-window
bind -n S-Right next-window

# ============================================================================
# SESSION MANAGEMENT
# ============================================================================

bind C-c new-session
bind C-f command-prompt -p "Find session:" "switch-client -t '%%'"

# Zen mode toggle
bind Z run-shell "~/.zen-mode.sh"

# ============================================================================
# UTILITY BINDINGS
# ============================================================================

# Tree mode tweaks
bind w choose-tree -w
set -g mode-style 'fg=default,bg=default,reverse'

# Capture pane to clipboard
bind-key C-y run-shell "tmux capture-pane -pS- | pbcopy"    # Capture entire pane (all scrollback)
bind-key M-y run-shell "tmux capture-pane -pS-200 | pbcopy" # Capture last 200 lines

# ============================================================================
# PLUGINS
# ============================================================================

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'Morantron/tmux-fingers'

# Disabled plugins
# set -g @plugin 'arl/tmux-gitbar'
# set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
# set -g @plugin 'tmux-plugins/tmux-git'

# ============================================================================
# PLUGIN CONFIGURATION
# ============================================================================

# tmux-fzf
set -g @tmux-fzf-launch 'F'

# tmux-continuum
set -g @continuum-restore 'on'

# tmux-fingers
set -g @fingers-key 'f'
set -g @fingers-copy-commands 'nvim:G'
set -g @fingers-hint-style bg=yellow,fg=black


# ============================================================================
# THEME & LOCAL OVERRIDES
# ============================================================================

# Initialize TMUX plugin manager
run '~/.tmux/plugins/tpm/tpm'

# vulpes-reddish2 theme
source-file ~/.dotfiles/vulpes-reddish2-dark-tmux.tmux.conf
# source-file ~/.dotfiles/vulpes-reddish2-light-tmux.tmux.conf

# Load local config AFTER everything else
if-shell "[ -f ~/.tmux.conf.local ]" 'source ~/.tmux.conf.local'
