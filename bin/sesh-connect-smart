#!/bin/bash
# Smart sesh connector that runs .t files if they exist

selected="$1"

if [ -z "$selected" ]; then
    exit 0
fi

# Check if it's an existing tmux session
if tmux has-session -t="$selected" 2>/dev/null; then
    # Already exists, just switch to it
    tmux switch-client -t "$selected"
    exit 0
fi

# It's a new directory, create session
session_name=$(basename "$selected" | tr . _)

# Create new session in the directory
tmux new-session -ds "$session_name" -c "$selected"

# Run .t file if it exists
if [ -x "$selected/.t" ]; then
    # Send the .t file to the first window
    tmux send-keys -t "$session_name:0" "$selected/.t" C-m
fi

# Switch to the new session
tmux switch-client -t "$session_name"
